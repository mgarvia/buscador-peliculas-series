"use strict";const searchInput=document.querySelector("#search__input"),searchButton=document.querySelector(".search__submit--button"),searchText=document.querySelector(".search__text"),resultTitle=document.querySelector(".results__title"),resultTitleBox=document.querySelector(".results__title--container"),resultsList=document.querySelector(".results__list"),favouriteList=document.querySelector(".favourites__list"),removeFavButton=document.querySelector(".favourite__remove--button"),urlBase="http://api.tvmaze.com/search/shows?q=";let moviesSearchedList=null,favouriteMovies=getFromLocal();const form=document.querySelector(".search__form"),inputBox=document.querySelector(".search__container"),searchIcon=document.querySelector(".icon__search--container"),removeSearchBtn=document.querySelector(".search__remove--button"),titleSearch=document.querySelector("#missing-o"),favTitleSection=document.querySelector(".favourites__title--container"),favSection=document.querySelector(".favourites"),favListSection=document.querySelector(".favourites__list--container"),favMessage=document.querySelector(".favourites__list--message"),welcome=document.querySelector(".landing"),welcomeText=document.querySelector(".welcome__text");function searchMovies(){event.preventDefault(),fetch(urlBase+searchInput.value).then(e=>e.json()).then(e=>{moviesSearchedList=e,printSearchResult(moviesSearchedList)})}function printSearchResult(e){welcome.classList.add("hidden"),resultsList.innerHTML="",searchText.innerHTML=`"${searchInput.value}"`,resultTitle.classList.remove("hidden"),resultTitleBox.style.borderBottom="1px solid lightgrey";for(let t of e){let e=t.show.image;e=null!==e?t.show.image.medium:"./assets/images/no-image-(yet).jpg";const i=document.createElement("li");i.setAttribute("id",t.show.id),i.setAttribute("class","movie__item");const o=document.createElement("div");o.setAttribute("class","movie__image");const n=document.createElement("a");n.setAttribute("href",t.show.url),n.setAttribute("alt",`ver ficha de ${t.show.name}`),n.setAttribute("title",`ver ficha de ${t.show.name}`),n.setAttribute("target","local");const s=document.createElement("img");s.setAttribute("src",e);const r=document.createElement("div");r.setAttribute("class","movie__title--container");const a=document.createElement("a");a.setAttribute("class","favourite__icon favourite__icon--movie heart__no-favourite");const l=document.createElement("p");l.setAttribute("class","movie__title"),l.setAttribute("title",t.show.name);const c=document.createTextNode(t.show.name);resultsList.appendChild(i),i.appendChild(o),o.appendChild(n),n.appendChild(s),i.appendChild(r),r.appendChild(a),r.appendChild(l),l.appendChild(c),addListenerToFavIcons()}paintDefaultFav()}function addListenerToFavIcons(){let e=document.querySelectorAll(".favourite__icon--movie");for(let t of e)t.addEventListener("click",saveFavouriteMovies)}function paintDefaultFav(e){let t=resultsList.querySelectorAll("li");for(let e of t){let t=favouriteMovies.findIndex(t=>t.id===e.id),i=e.firstElementChild.nextElementSibling.firstElementChild;-1!==t&&addFavStyle(i)}}function saveFavouriteMovies(e){let t=e.currentTarget;const i=t.parentElement.parentElement.id,o=t.nextElementSibling.title,n=t.parentElement.previousElementSibling.firstElementChild.firstElementChild.src,s=t.parentElement.previousElementSibling.firstElementChild.href;let r={};if(r.id=i,r.title=o,r.image=n,r.link=s,t.classList.contains("heart__no-favourite"))favouriteMovies.push(r),addFavStyle(t);else{let e=favouriteMovies.findIndex(e=>e.id===i);favouriteMovies.splice(e,1),removeFavStyle(t)}setToLocal(),printFavouriteList(),removeFavButton.classList.remove("hidden")}function addFavStyle(e){e.classList.remove("heart__no-favourite"),e.classList.add("heart__favourite"),e.nextElementSibling.classList.add("favourite__textColor"),e.parentElement.previousElementSibling.classList.add("favourite__background")}function removeFavStyle(e){let t=document.querySelectorAll(".movie__item");const i=e.parentElement.parentElement.id;for(let e of t)if(e.id===i){const t=e.firstElementChild.nextElementSibling.firstElementChild;t.classList.remove("heart__favourite"),t.classList.add("heart__no-favourite"),t.nextElementSibling.classList.remove("favourite__textColor"),t.parentElement.previousElementSibling.classList.remove("favourite__background")}}function printFavouriteList(){favouriteList.innerHTML="",removeFavButton.classList.add("hidden");for(let e of favouriteMovies){const t=document.createElement("li");t.setAttribute("id",e.id),t.setAttribute("class","favourite__item");const i=document.createElement("div");i.setAttribute("class","favourite__image");const o=document.createElement("a");o.setAttribute("href",e.link),o.setAttribute("alt",`ver ficha de ${e.title}`),o.setAttribute("title",`ver ficha de ${e.title}`),o.setAttribute("target","local");const n=document.createElement("img");n.setAttribute("src",e.image);const s=document.createElement("div");s.setAttribute("class","favourite__title--container");const r=document.createElement("a");r.setAttribute("class","favourite__icon favourite__icon--favList heart__favourite"),r.setAttribute("title","Eliminar de favoritos");const a=document.createElement("p");a.setAttribute("class","favourite__title"),a.setAttribute("title",e.title);const l=document.createTextNode(e.title);favouriteList.appendChild(t),t.appendChild(i),i.appendChild(o),o.appendChild(n),t.appendChild(s),s.appendChild(r),s.appendChild(a),a.appendChild(l),addListenerToFavourites()}""!==favouriteList.innerHTML?(removeFavButton.classList.remove("hidden"),favMessage.classList.add("hidden"),favTitleSection.style.borderBottom="1px solid lightgrey"):(removeFavButton.classList.add("hidden"),favMessage.classList.remove("hidden"),favTitleSection.style.borderBottom="none"),""===resultsList&&(resultTitleBox.style.borderBottom="none")}function addListenerToFavourites(){let e=document.querySelectorAll(".favourite__icon--favList");for(let t of e)t.addEventListener("click",saveFavouriteMovies)}function removeAllFavourites(){removeStyleDisplayed(),removeFavList(),removeFromLocal(),favMessage.classList.remove("hidden")}function removeStyleDisplayed(){let e=document.querySelectorAll(".heart__favourite");for(let t of e)console.log(t),removeFavStyle(t)}function removeFavList(){favouriteList.innerHTML="",removeFavButton.classList.add("hidden")}function setToLocal(){localStorage.setItem("favouriteMovies",JSON.stringify(favouriteMovies))}function getFromLocal(){let e=JSON.parse(localStorage.getItem("favouriteMovies"));return null!==e?e:[]}function removeFromLocal(){localStorage.removeItem("favouriteMovies")}function changePlaceholder(){searchInput.placeholder="Escribe un título aquí"}function originalPlaceholder(){searchInput.placeholder="Series & películas"}function moveSearchIcon(){searchIcon.classList.add("moveIcon"),titleSearch.classList.add("show-o"),titleSearch.classList.remove("hide-o"),inputBox.classList.remove("input__shadow"),addListenerToSearchIcon(),addRemoveSearchButton()}function addListenerToSearchIcon(){searchIcon.addEventListener("click",searchMovies),searchIcon.style.cursor="pointer"}function addRemoveSearchButton(){removeSearchBtn.classList.remove("hidden"),addListenerToRemoveBtn()}function addListenerToRemoveBtn(){removeSearchBtn.addEventListener("click",removeTextSearch)}function removeTextSearch(){searchInput.value="",searchInput.focus(),inputBox.classList.add("input__shadow")}function originalTitle(){""!==searchInput.value?(searchIcon.classList.add("moveIcon"),titleSearch.classList.add("show-o"),titleSearch.classList.remove("hide-o"),removeSearchBtn.classList.remove("hidden")):(searchIcon.style.cursor="",searchIcon.classList.remove("moveIcon"),titleSearch.classList.remove("show-o"),titleSearch.classList.add("hide-o"),removeSearchBtn.classList.add("hidden"))}function setPointerInInput(){searchInput.focus(),moveSearchIcon()}function enableSearchButton(){searchButton.removeAttribute("disabled","disabled")}function disableValidationMessage(e){e.preventDefault()}function showFavList(){screen.width<768?"inherit"!==favListSection.style.display?favListSection.style.display="inherit":(favListSection.style.display="none",favTitleSection.style.borderBottom="none"):favListSection.style.display="block"}searchButton.addEventListener("click",searchMovies),window.addEventListener("load",printFavouriteList),removeFavButton.addEventListener("click",removeAllFavourites),searchInput.addEventListener("mouseover",changePlaceholder),searchInput.addEventListener("mouseout",originalPlaceholder),searchInput.addEventListener("click",moveSearchIcon),searchInput.addEventListener("focusout",originalTitle),searchInput.addEventListener("focus",enableSearchButton),welcomeText.addEventListener("click",setPointerInInput),form.addEventListener("invalid",disableValidationMessage,!0),favTitleSection.addEventListener("click",showFavList);